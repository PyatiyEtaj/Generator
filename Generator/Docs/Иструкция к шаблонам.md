# **Инструкция по созданию шаблонов**

Предположим, что имеется некоторое задание и нужно сделать новую версию данного задания.

Листинг 1 - Первоначальное задание
> Написать программу для вычисления функции  y = f(x)
> - y = cos(x) / (x + 10) при x < -3
> - y = e ^ (0.1x)        при -3 <= x < 4
> - y = lg(x)            при 4 <= x < 6
> - y = sin(x)       при x >= 6

Для создания варианта, имеющегося задания, нужно сгенерировать новые выражения и диапазоны. Сгенерированные данные нужно подставить определенные места :

Листинг 2 - Подстановка выражений и диапазонов
> Написать программу для вычисления функции y = f(x)
> - y = (выражение 1) при x < (1-ый диапазон)
> - y = (выражение 2) при (1-ый диапазон) <= x < (2-ой диапазон)
> - y = (выражение 3) при (2-ой диапазон) <= x < (3-ий диапазон)
> - y = (выражение 4) при x <= (3-ий диапазон)

Для генерации подобных задания нужно использовать шаблон расположенный в листинге 3. 

Листинг 3 - Шаблон задания
```
1. | ----
2. | ШАБЛОННЫЙ_ВИД   // данный блок содержит общий вид задания
3. | Написать программу для вычисления функции y = f(x)
4. | 
5. |  y = @выражение 1@ где x1 < @1-ый диапазон@
6. |  y = @выражение 2@ где @1-ый диапазон@ <= x1 < @2-ой диапазон@
7. |  y = @выражение 3@ где @2-ой диапазон@ <= x1 < @3-ий диапазон@
8. |  y = @выражение 4@ где x1 >= @3-ий диапазон@
9. | 
10.| ----
11.| ХРАНИЛИЩЕ_ОБЪЕКТОВ
12.| выражение 1 : #genAE(5); // генерация арифм. выражений
13.| код 1 : #getAEcode();    // код на C++ для вычисления пред. выражения
14.| 
15.| выражение 2 : #genAE(5);
16.| код 2 : #getAEcode();
17.| 
18.| выражение 3 : #genAE(5);
19.| код 3 : #getAEcode();
20.| 
21.| выражение 4 : #genAE(5);
22.| код 4 : #getAEcode();
23.| // rnd (Random) - генерация случайного числа
24.| 1-ый диапазон : #rnd( 0.0  , 5.0  , double); // в диапазоне [0.0; 5.0) типа double 
25.| 2-ой диапазон : #rnd( 5.0  , 10.0 , double); // в диапазоне [5.0; 10.0) типа double
26.| 3-ий диапазон : #rnd( 10.0 , 15.0 , double); // в диапазоне [10.0; 15.0) типа double
27.| 
28.| выражение 5: sin(x) + 88 * 99 - 123;
29.|
30.| ----
31.| РЕШЕНИЕ // данная секция хранит эталонное решение
32.| #include <cmath>
33.| #include <iostream>
34.| 
35.| using namespace std;
36.| 
37.| int main()
38.| {
39.|     double y = 0.0;
40.|     double x1;
41.|     cin >> x1;
42.| 
43.|     if ( x1 <  @1-ый диапазон@) // подстановка 1-го диапазона
44.|     {        
45.|         @код 1@ // подстановка сгенерированного кода для вычисления выражения 1
46.|     }
47.|     else if (x1 >=  @1-ый диапазон@ && x1 < @2-ой диапазон@) // диапазон 1 и 2
48.|     {
49.|         @код 2@ // подстановка сгенерированного кода для вычисления выражения 2
50.|     }
51.|     else if (x1 >= @2-ой диапазон@ && x1 < @3-ий диапазон@) // диапазон 2 и 3
52.|     {
53.|     	@код 3@ // подстановка сгенерированного кода для вычисления выражения 3
54.|     }
55.|     else if (x1 >= @3-ий диапазон@) // подстановка 3-го диапазона
56.|     {
57.|         @код 4@ // подстановка сгенерированного кода для вычисления выражения 4
58.|     }
59.|     cout << y << "\n";
60.|     system("pause");
61.|     return 0;
62.| }
63.| ----
64.| СЛУЖЕБНОЕ // данная секция хранит настройки генератора
65.|   знаки_арифм : + | - | * | / | ^;
66.| функции_арифм : sin | cos | sqrt | tan | log | log10;
67.| ----
68.| ТЕСТОВЫЕ_ДАННЫЕ // здесь хранятся тестовые данные для прогона программ
69.| Тест1 : #rnd(100 , 200 , int , 1000);
70.| Тест2 : 1, 2, 3, 4, 5, 6, 7, 8, 9, 10;
71.| ----
```

Первой секцией в листинге 3 является `ШАБЛОННЫЙ_ВИД`, блок в котором содержится генерируемое задание, состоящее из общей для всех вариантов части, а также мест в которые будут подставляться случайно-сгенерированные данные.
> y = **@выражение 1@** где x1 < **@1-ый диапазон@**

Это 5-ая строка из листинга 3, здесь отмеченные части - это места в которые будут подставляться генерируемые данные, не отмеченные части, соответсвенно одинаковы для всех вариантов. В данном примере используются два объекта-параметра `@выражение 1@` и `@1-ый  диапазон@`, эти параметры и еще некоторые хранятся в блоке `ХРАНИЛИЩЕ_ОБЪЕКТОВ`.

`ХРАНИЛИЩЕ_ОБЪЕКТОВ` расположено в строках `11-27` и содержит в себе все объекты-параметры, применяемые в шаблоне. Объекты-параметры своего рода переменные, которые хранят либо уже готовый набор символов, либо исполняемую функцию.

Для примера обратимся к строке 12, здесь объекта-параметр `выражение 1` содержит исполняемую функцию `#genAE(5)` (расшифровывается как _generate arithmenic expression_), данная функция генерирует случайное арифметическое выражение сложность 5 (сумма знаков и функций, например: _sin_, _cos_, _log_ и т.д.).

Функция `#genAE(5)` например может сгенерировать выражение `cos((-2 / x1) * x1)` и закрепить полученные данные за переменной `выражение 1`
```
до подстановки =
    y = @выражение 1@
после подстановки =
    y = cos((-2 / x1) * x1)
```

Далее обртимся к строке 13 к объекту-параметру `код 1` привязана функция `#getAEcode()` (расшифровывается как _get arithmenic expression code_), данная функция возвращает код на ЯП `C++` (вместе с проверкой на вычисляемость) для вычисления **последнего сгенерированного выражения функцией `#genAE()`**. 
```
до подстановки =
    y = @выражение 1@
    код = @код 1@
после подстановки =
    y = cos((-2 / x1) * x1)
    код = if (x1 != 0 ) y = cos((-2 / x1) * x1); else y = 0.0;
```

Из примера выше становится более понятно, что данные функции сильно связаны друг с другом.

Следующий уникальным объектом-параметром является `1-ый диапазон` и привязанная к нему функция `#rnd(0.0, 5.0, double)` (расшифровывается как _random_). Функция вовзращает случайное число типа `double` из диапазона от 0.0 до 5.0 **не включая верхнюю границу**

```
до подстановки =
    y = @выражение 1@ где х1 < @1-ый диапазон@
    if ( x1 <  @1-ый диапазон@)
    {        
         @код 1@
    }

после подстановки =
    y = cos((-2 / x1) * x1) где х1 < 2.67
    if ( x1 <  2.67)
    {        
         if (x1 != 0 ) y = cos((-2 / x1) * x1); else y = 0.0;
    }
```

Есть еще один объект-параметр из строки 28 это `выражение 5` и собственно его значение `sin(x) + 88 * 99 - 123`, данный параметр нигде не используется, он указан лишь для того чтобы показать как можно использовать заготовленные данные.

Следующая секция `РЕШЕНИЕ` - потенциальное эталонное решение, созданное преподавателем и которое в дальнейшем будет использоваться для проверки студенческих работ. В листинге 3 данной блок расположен в строках 31-62, здесь все работает по тому же принципу как и в секции `ШАБЛОННЫЙ_ВИД`, есть общие места, а есть места подстановки объектов-параметров.

Предпоследний блок `СЛУЖЕБНОЕ`, находящийся в строках 64-66, служит для настройки генератора. На данный момент есть два значения `функции_арифм` и `знаки_арифм`, данные настройки отвечают за знаки и функции, которые будут использоваться при генерации арифметических выражений.

Последний блок в шаблоне это `ТЕСТОВЫЕ_ДАННЫЕ`, находящийся в строках 68-70 и который содержит в себе тестовые данные, которые будут применяться при тестировании работ студентов, здесь также как и в `ХРАНИЛИЩЕ_ОБЪЕКТОВ` можно создавать объекты-параметры, которые будут содержать либо уже заготовленные тестовые данные строка 70 или содержать функцию `#rnd(100, 200, int, 1000)`, это все таже функция Random, лишь с тем отличием, что здесь создается не одно значение а сразу 1000.

# **Подробное описание блоков**

Шаблон задания состоит из пяти секций (листинг 3, строки: `2, 11, 31, 64, 68`), также необходимо обратить внимание на то, что начало каждой секции отделяется от предыдущей последовательностью символов : `----\n`, данная последовательность должна заканчиваться концом строки `\n`.

```         
1. | ----
2. | ШАБЛОННЫЙ_ВИД

10.| ----
11.| ХРАНИЛИЩЕ_ОБЪЕКТОВ

30.| ----
31.| РЕШЕНИЕ
      
63.| ----
64.| СЛУЖЕБНОЕ
      
67.| ----
68.| ТЕСТОВЫЕ_ДАННЫЕ   
```

## Примечание: 

Для более удобного расшифровывания шаблон-файл есть набор метасимволов, который предназначен для резделения лексем. К ним относятся [ `: ; | " @` ]. Eсли необходимо использовать эти символы в качестве текстовых знаков, можно использовать экранирующий символ [ `\` ]. При подстановке в текст символ [ `\` ] будет убираться.

***Данное правило относится лишь к объектам-параметрам, во всех остальных местах никакие экранирующие символы использовать не нужно.***

> ### Пример:
> **В данном случае все знаки используются для разделения лексем**
> - выражение 1 **:** sin x + 23 **|** x * 2 + x * x **;**
> 
> **В следующих примерах некоторые символы выступают в качестве текстовых знаков. При использовании данных объектов-параметров в тексте - символ `\` удалится**
> - задание : реализовать возведение в степень , не используя математическую библиотеку, для чисел в диапазоне [1 **\\;** 100];
> - знание : оператор **\\|\\|** является логическим ИЛИ;


## **Секция № 1 - ХРАНИЛИЩЕ_ОБЪЕКТОВ**

`ХРАНИЛИЩЕ_ОБЪЕКТОВ` - хранит объекты-параметры. 

`Объект-параметр` - переменная, хранящая строку (здесь подразумевается неограниченный набор символов). Объект-параметр может содержать как уже готовую последовательность символов так и исполняемую функцию (при вызове параметра где-либо в шаблоне функция сначала исполняется и подставляется уже результат, который выдала функция).

Объект-параметр имеет следующий синтаксис :
```
объект_параметр = “имя объекта-параметра” “:” значение_объекта_параметра {“|” значение_объекта_параметра} “;”
значение_объекта_параметра = “набор символов юникода” | функция
функция = “#имя_функции({аргументы функции [,]})”
```
Если описывать проще то синтаксис можно представить следующим образом (пробелы не играют никакой роли):
```
имя параметра : содержимое объекта параметра;
  выражение 1 : решите выражение - sin(x) + x * 10 + 5;
```

1. Имя параметра может содержать любые символы (исключение составляют специальные символы - [ ` : , ; | @ " \n` ]);
2. Cодержимое может являться либо функцией либо уже готовым значением, перемешивание недопустимо;
3. Объекту-параметру изнально можно задать несколько значений, используя символ [ `|` ]. В дальнейшем выберется одно случайное значение, которое и будет использоваться.

Далее построчно опишем используемые объекты-параметры из листинга 3.

#### Функция #genAE(x)
Обратимся к строкам: `12, 15, 18, 21`
```
12.| выражение 1 : #genAE(5);
15.| выражение 2 : #genAE(5);
18.| выражение 3 : #genAE(5);
21.| выражение 4 : #genAE(5);
```
Здесь объекты-параметры содержат исполняемую функцию `#genAE(х)` - данная функция генерирует арифметическое выражения сложностью `х` (сумма знаков и функций: sin, cos, log и т.д.).

Пример:
```
 было = выражение 1 : #genAE(5);
стало = выражение 1 : cos(-99.45 + log(51.01 - (18.82 * x1)));
```
#### Функция #getAEcode()
Теперь посмотрим на строки: `13, 16, 19, 22`
```
13.| код 1 : #getAEcode();
16.| код 2 : #getAEcode();
19.| код 3 : #getAEcode();
22.| код 4 : #getAEcode();
```
Здесь объекты-параметры содержат исполняемую функцию `#getAEcode()` - функция, генерирующая код на языке `C++` для вычисления последнего сгенерированного арифметическое выражения (код содержит само выражение, а также условия при которых оно вычисляется).

Пример :

```
было =
    выражение 1 : #genAE(5);
    код 1 : #getAEcode();

стало =
    выражение 1 : cos(-99.45 + log(51.01 - (18.82 * x1)));
    код 1 : if (((51.01 - (18.82 * x1)) > 0 && (51.01 - (18.82 * x1)) != 1))
                 y = cos(-99.45 + log(51.01 - (18.82 * x1)));
            else 
                 y = 0.0;
```
#### Функция #rnd(min, max, type)

Строки:  `24-26`
```
24.| 1-ый диапазон : #rnd( 0.0  , 5.0  , double);
25.| 2-ой диапазон : #rnd( 5.0  , 10.0 , double);
26.| 3-ий диапазон : #rnd( 10.0 , 15.0 , double);
```

Объекты-параметры из данных строк содержат исполняемую функцию `#rnd(min, max, type)` - функция, генерирующая случайное число в диапазоне [`min` ; `max`] типа `type` (на данный момент можно использовать значения `int` и `double`).

Пример:
```
 было = 1-ый диапазон : #rnd(1, 10, int);
стало = 1-ый диапазон : 5;
```

_Полное описание доступных функций будет изложено в конце документа._
### Подстановка объектов-параметров
На данном этапе стало более понятно что представляют собой объекты-параметры. Теперь нужно сказать о там как их использовать, все довольно просто, чтобы использовать параметр нужно прибегнуть к следующему синтаксису:
```
@имя_объекта_параметра@
```
**Между знаками `@` и `имя_объекта_параметра` пробелов быть не должно.**

Пример использования подстановок:
```
было = 
    количество : 100;
    задание: запишите в файл 'Input.txt' @количество@ знаков;

стало = 
    количество : 100;
    задание: запишите в файл 'Input.txt' 100 знаков;

```

## **Секция 2 - ШАБЛОННЫЙ_ВИД**

Данная секция шаблон-файла содержит конкретный вид варианта задания. В данном блоке можно и нужно использовать ранее описанные объекты-параметры.

Обратимся к строкам `1-8`
```
1. | ----
2. | ШАБЛОННЫЙ_ВИД
3. | Написать программу для вычисления выражения :
4. | 
5. | - y = @выражение 1@ **где x1 < @1-ый диапазон@**
6. | - y = @выражение 2@ **где @1-ый диапазон@ <= x1 < @2-ой диапазон@**
7. | - y = @выражение 3@ **где @2-ой диапазон@ <= x1 < @3-ий диапазон@**
8. | - y = @выражение 4@ **где x1 >= @3-ий диапазон@**
```

Данный блок содержит задание в которое будут подставляться ранее описанные объекты-параметры: `@выражение 1@`, `@выражение 2@`, `@выражение 3@`, `@выражение 4@`, `@1-ый диапазон@`, `@2-ый диапазон@`, `@3-ый диапазон@`. 

Примечание:
Посмотрим на строку 5

> 5.| `-` y = @выражение 1@ `**`где x1 < @1-ый диапазон@`**`

Помеченные символы являются частью языка разметки `markdown` и используются для форматирования текста, использование `markdown` не является обязательным, если у вас нет времени на изучение `markdown`, вы можете игнорировать использование данного языка и описывать все так как вы привыкли.

Примерный вид готового задания с использованием форматирования может выглядеть следующим образом:

> Написать программу для вычисления выражения :
> 
> - y = (x1 - (-6 * x1)) + 3 **где x1 < 3**
> - y = log(cos(pow(1, (-6 * x1)))) **где 3 <= x1 < 7**
> - y = -10 + (sin(9 - x1) * 8) **где 7 <= x1 < 14**
> - y = sqrt(6 - (-1 + x1)) **где x1 >= 14**

## **Секция 3 - РЕШЕНИЕ**

`РЕШЕНИЕ` - хранит эталонное решения для задания. Эталонное решение компилируется и используется для тестирования других программ предназначенных для выполнения поставленных задач.

Данная секция является копией `ШАБЛОННОГО_ВИДА`, здесь также можно использовать объекты-параметры. Отличительная черта данного блока это данные, а именно код который должен успешно компилироваться или интерпретироваться, привязки к определенному ЯП нет. Из _'коробки'_ генератор обращается к модулю проверки заданий, который компилирует эталонное решения, используя `g++` (подразумевается, что решение написано ЯП `C++`). В случае если эталонное решение написано на другом языке, можно использовать флаг `compile=false`, тогда генератор будет создавать лишь код, без последующей компиляции.

Эталонное решение описано в листинге 3 в строках: `31-62`.

## **Секция 4 - СЛУЖЕБНОЕ**

`СЛУЖЕБНОЕ` - секция отвечающая за настройку генератора. На данный момент есть лишь 2 параметра :

* `знаки_арифм` – отвечает за символы, которые будут использоваться во время генерации арифметических выражений;
* `функции_арифм` – отвечает за функции, которые будут использоваться во время генерации арифметических выражений.

Данная секция представлна в листинге 3 в строках `64-66`.

## **Секция 5 - ТЕСТОВЫЕ_ДАННЫЕ**

`ТЕСТОВЫЕ_ДАННЫЕ` - секция которая содержит данные для тестирования эталонного решения и решения, присланного обучаемым;

Данный блок схож с `ХРАНИЛИЩЕМ_ОБЪЕКТОВ`, здесь также описываются объекты-параметры. В данной секции можно указывать заготовленные данные через запятую или же использовать какие-либо функции, например использовать функцию для генерации большого количества случайных чисел в диапазоне и т.д.


Данная секция представлна в листинге 3 в строках `68-70`.

# Полное описание доступных функций:
 * `#rnd ( нижняя_граница , верхняя_граница , тип {, количество})` - генерирует случайное число в границе [ нижняя_граница, верхняя_граница) типа `тип (double или int)`. Если необходимо сгенерировать сразу несколько значений используется дополнительный параметр “количество”, в таком случае сгенерированные числа будут разделены запятыми;
    ```
     было = число : #rnd(1, 10, int);
    стало = число : 5;
    ```
  
 * `#genAE(сложность {, граница , тип , количество переменных})` - генерирует выражение некоторой сложности (сложность указывает количество знаков и функций (например log, sin и т.д.)), граница указывает диапазон генерации констант [-граница, граница), тип указывает на тип генерируемых констант (`double` или `int`), количество переменных, указывает на зависимость выражения от количества переменных (от 1 до бесконечности);
    ```
     было = выр : #genAE(5);
    стало = выр : cos(-99.45 + log(51.01 - (18.82 * x1)));

     было = выр2 : #genAE(5 , 50.0 , double , 2);
    стало = выр2 : (x1 / ((x2 + tan(x1)) * 18.82)) + x1;
    ```
 * `#getAEcode()` - возвращает код для вычисления последнего сгенерированного выражения (вместе с проверками на возможность вычисления выражения) на языке `C++`.
    ```
    было =
        выр : #genAE(5);
        код : #getAEcode();

    стало =
        выр : cos(-99.45 + log(51.01 - (18.82 * x1)));
        код : if (((51.01 - (18.82 * x1)) > 0 && (51.01 - (18.82 * x1)) != 1))
                   y = cos(-99.45 + log(51.01 - (18.82 * x1)));
              else 
                   y = 0.0;
    ```
 * `#lua(код_на_луа)` - данная функция является второстепенной и предназначена для выполнения кода на `Lua` (изначально предполагалось использовать `Lua` лишь для вычисления мат. выражений, но в дальнейшем данный язые будет использовать для расширения предоставляемого функционала генератора). Все системные функции (кроме получения времени и даты) на `Lua` которые обращаются к OS запрещены в целях безопасности.
    ```
    было =
        число : #lua("
                math.randomseed(12345689);
                return math.random(100);
            ");
    стало =
        число : 88;
    ```

